import{readdirSync as n,readFileSync as r}from"fs";import{join as e,resolve as t}from"path";function u(n){if(!n)return n;var r=n.lastIndexOf(".");return r>=0?n.substring(0,r):n}function i(n){if(!n)return n;var r=n.lastIndexOf(".");return r>=0?n.substring(r+1):null}var a=/^\$\s*(.+?)\s*\$$/,o="_DEFAULT_GROUP_";function c(n){var r=[{name:o,docs:[]}],e={groups:r};if(!n)return e;for(var t=n.split(/[\n|\r\n]/g),u=r[0],i=function(n,e){var i=t[n].trim();if(!i)return"continue";var o,c,f="",s=(o=i,(c=a.exec(o))?c[1]:null),m=s;if(!s){var l=i.split("$");f=l[0],m=l[1]||s}m&&((u=r.find((function(n){return n.name===m})))||(u={name:m,docs:[]},r.push(u))),s||u.docs.push({name:f,order:u.docs.length})},c=0,f=t.length;c<f;c++)i(c);return e}var f=".ORDER";function s(n){return n&&n.isFile()&&/\.md$/gi.test(n.name)}function m(n){return n&&n.isDirectory()&&!/^[._]/gi.test(n.name)}function l(t){var i,a=n(t,{withFileTypes:!0}),l=a.filter((function(n){return s(n)})),d=a.findIndex((function(n){return n.isFile()&&n.name.toUpperCase()===f})),p=c(d<0?null:r(e(t,a[d].name),{encoding:"utf-8"})),v=l.reduce((function(n,r){var e=n[0],t=n[1];return e[u(r.name)]=r,t[r.name]=r,n}),[{},{}]),g=v[0],h=v[1],x={},$=p.groups.map((function(n){return{name:n.name===o?"":n.name,docs:n.docs.map((function(n){var r=g[n.name]||h[n.name];return x[r.name]=1,{name:n.name||"",file:r}})),dirs:a.filter((function(n){return m(n)}))}})),y=l.filter((function(n){return!x[n.name]})).map((function(n){return{name:u(n.name),file:n}}));return y.length&&(i=$[0].docs).push.apply(i,y),$}function d(n){return n.replace(/\\+/g,"/")}function p(n){return n?d(/^\//.test(n)?n:"/".concat(n)):n}var v={docs:t(process.cwd(),"docs")};function g(n){var r=l(e(v.docs,n)).reduce((function(n,r){return n.push.apply(n,r.docs.map((function(n){return n.file}))),n}),[]);if(!r.length)return null;var t=d(e(n,r[0].name));return/^\//.test(t)||(t="/"+t),t}function h(){var n={},r=function(t,i){void 0===i&&(i="");var a=l(t);i&&(n[p(i)]=a.filter((function(n){return n.docs.length})).map((function(n){return{text:n.name,collapsible:!0,items:n.docs.map((function(n){return{text:u(n.file.name),link:p(e(i,n.file.name))}}))}}))),a.forEach((function(n){n.dirs.forEach((function(n){r(e(t,n.name),e(i,n.name))}))}))};return r(t(v.docs)),n}export{h as autoGenerateSidebar,u as getBasename,i as getExtension,g as getFirstDocLink,p as getLinkPath,s as isDocFile,m as isValidDir,d as normalize,l as readDocGroups};
